# PID –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è —Ä–æ–±–æ—Ç–∞ StackForce

## –ß—Ç–æ —Ç–∞–∫–æ–µ PID –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä?

PID (Proportional-Integral-Derivative) –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä - —ç—Ç–æ –∞–ª–≥–æ—Ä–∏—Ç–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑—å—é, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è.

### –°–æ—Å—Ç–∞–≤–ª—è—é—â–∏–µ PID:

1. **P (–ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è)** - —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Ç–µ–∫—É—â—É—é –æ—à–∏–±–∫—É
   - –§–æ—Ä–º—É–ª–∞: `P = Kp √ó error`
   - –ß–µ–º –±–æ–ª—å—à–µ –æ—à–∏–±–∫–∞, —Ç–µ–º —Å–∏–ª—å–Ω–µ–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏—è

2. **I (–ò–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω–∞—è)** - –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—É—é –æ—à–∏–±–∫—É
   - –§–æ—Ä–º—É–ª–∞: `I = Ki √ó ‚à´error¬∑dt`
   - –£—Å—Ç—Ä–∞–Ω—è–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é –æ—à–∏–±–∫—É

3. **D (–î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è)** - –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –±—É–¥—É—â—É—é –æ—à–∏–±–∫—É
   - –§–æ—Ä–º—É–ª–∞: `D = Kd √ó d(error)/dt`
   - –£–º–µ–Ω—å—à–∞–µ—Ç –ø–µ—Ä–µ—Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–æ–ª–µ–±–∞–Ω–∏—è

**–í—ã—Ö–æ–¥:** `output = P + I + D`

## –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ —á–µ—Ç—ã—Ä–µ—Ö–Ω–æ–≥–æ–º —Ä–æ–±–æ—Ç–µ

### 1. –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞ (IMU)

–ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª–æ–∂–µ–Ω–∏—è —Ç–µ–ª–∞ —Ä–æ–±–æ—Ç–∞:

```cpp
#include "pid.h"

// PID –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ –ø–æ –∫—Ä–µ–Ω—É (roll)
PID rollPID(2.0, 0.1, 0.5);  // Kp=2.0, Ki=0.1, Kd=0.5
rollPID.setOutputLimits(-30, 30);  // ¬±30¬∞ –∫–æ—Ä—Ä–µ–∫—Ü–∏—è

void loop() {
    // –ü–æ–ª—É—á–µ–Ω–∏–µ —É–≥–ª–∞ –æ—Ç IMU
    imu.update();
    float currentRoll = imu.getRoll();
    
    // –¶–µ–ª–µ–≤–æ–π —É–≥–æ–ª = 0¬∞ (–≥–æ—Ä–∏–∑–æ–Ω—Ç)
    float rollCorrection = rollPID.compute(0.0, currentRoll);
    
    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –∫ –≤—ã—Å–æ—Ç–µ –Ω–æ–≥
    adjustLegHeight(rollCorrection);
}
```

### 2. –ö–æ–Ω—Ç—Ä–æ–ª—å —Å–∫–æ—Ä–æ—Å—Ç–∏ –º–æ—Ç–æ—Ä–æ–≤

–ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–≤–∏–∂–µ–Ω–∏—è:

```cpp
// PID –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –ª–µ–≤–æ–≥–æ –º–æ—Ç–æ—Ä–∞
PID speedPID(1.5, 0.05, 0.2);
speedPID.setOutputLimits(-100, 100);  // ¬±100 PWM

void loop() {
    // –¶–µ–ª–µ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å 50 RPM
    float targetSpeed = 50.0;
    float currentSpeed = getMotorSpeed();
    
    // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ PWM –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
    float pwm = speedPID.compute(targetSpeed, currentSpeed);
    motor.setSpeed(pwm);
}
```

### 3. –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≥

–¢–æ—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ–º –Ω–æ–≥:

```cpp
// PID –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏ –ø–ª–µ—á–µ–≤–æ–≥–æ —Å–µ—Ä–≤–æ
PID shoulderPID(3.0, 0.2, 0.8);
shoulderPID.setOutputLimits(0, 180);  // 0-180¬∞ —Å–µ—Ä–≤–æ

void loop() {
    float targetAngle = 90.0;  // –¶–µ–ª–µ–≤–æ–π —É–≥–æ–ª
    float currentAngle = servo.getAngle();
    
    float newAngle = shoulderPID.compute(targetAngle, currentAngle);
    servo.setAngle(newAngle);
}
```

### 4. –ö–æ–Ω—Ç—Ä–æ–ª—å –≤—ã—Å–æ—Ç—ã —Ç–µ–ª–∞

–ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–Ω–æ–π –≤—ã—Å–æ—Ç—ã –Ω–∞–¥ –∑–µ–º–ª–µ–π:

```cpp
// PID –¥–ª—è –≤—ã—Å–æ—Ç—ã —Ç–µ–ª–∞
PID heightPID(2.5, 0.15, 0.6);
heightPID.setOutputLimits(50, 150);  // 50-150mm –≤—ã—Å–æ—Ç–∞

void loop() {
    float targetHeight = 100.0;  // 100mm
    float currentHeight = calculateBodyHeight();
    
    float newHeight = heightPID.compute(targetHeight, currentHeight);
    setAllLegsHeight(newHeight);
}
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ (PID Tuning)

### –ú–µ—Ç–æ–¥ Ziegler-Nichols (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π):

1. **–ù–∞—á–Ω–∏—Ç–µ —Å Kp, Ki=0, Kd=0**
2. **–£–≤–µ–ª–∏—á–∏–≤–∞–π—Ç–µ Kp** –ø–æ–∫–∞ —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –Ω–∞—á–Ω–µ—Ç –∫–æ–ª–µ–±–∞—Ç—å—Å—è
3. **–£–º–µ–Ω—å—à–∏—Ç–µ Kp** –Ω–∞ 50%
4. **–î–æ–±–∞–≤—å—Ç–µ Ki** –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏ (–Ω–∞—á–Ω–∏—Ç–µ —Å Kp/10)
5. **–î–æ–±–∞–≤—å—Ç–µ Kd** –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∫–æ–ª–µ–±–∞–Ω–∏–π (–Ω–∞—á–Ω–∏—Ç–µ —Å Kp/4)

### –û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

| –°–∏–º–ø—Ç–æ–º | –†–µ—à–µ–Ω–∏–µ |
|---------|---------|
| –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è | –£–≤–µ–ª–∏—á–∏—Ç—å Kp |
| –ö–æ–ª–µ–±–∞–Ω–∏—è | –£–º–µ–Ω—å—à–∏—Ç—å Kp, —É–≤–µ–ª–∏—á–∏—Ç—å Kd |
| –û—Å—Ç–∞—Ç–æ—á–Ω–∞—è –æ—à–∏–±–∫–∞ | –£–≤–µ–ª–∏—á–∏—Ç—å Ki |
| –ü–µ—Ä–µ—Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ | –£–≤–µ–ª–∏—á–∏—Ç—å Kd |
| –ù–µ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å | –£–º–µ–Ω—å—à–∏—Ç—å –≤—Å–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã |

### –¢–∏–ø–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Ä–æ–±–æ—Ç–∞:

**–ë–∞–ª–∞–Ω—Å (IMU —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è):**
```cpp
PID balancePID(2.0, 0.1, 0.5);  // –£–º–µ—Ä–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è
```

**–°–∫–æ—Ä–æ—Å—Ç—å –º–æ—Ç–æ—Ä–æ–≤:**
```cpp
PID speedPID(1.5, 0.05, 0.2);  // –ë—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è, –º–∞–ª—ã–π Ki
```

**–ü–æ–∑–∏—Ü–∏—è:**
```cpp
PID positionPID(3.0, 0.2, 0.8);  // –í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å
```

## –ü—Ä–∏–º–µ—Ä—ã –∏–∑ StackForce

### Lesson9: –ë–∏–æ–∏–º–∏—Ç–∞—Ü–∏—è –ø–æ—Ö–æ–¥–∫–∏ —Å PID

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
- –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ –∫–æ—Ä–ø—É—Å–∞ –ø—Ä–∏ —Ö–æ–¥—å–±–µ
- –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ –Ω–∞–∫–ª–æ–Ω–∞ –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ –≤–µ—Å–∞
- –ü–ª–∞–≤–Ω–æ–≥–æ —Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏

```cpp
// –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
PID rollPID(2.0, 0.1, 0.5);
PID pitchPID(2.0, 0.1, 0.5);

void balanceControl() {
    imu.update();
    
    float rollError = rollPID.compute(0, imu.getRoll());
    float pitchError = pitchPID.compute(0, imu.getPitch());
    
    // –ö–æ—Ä—Ä–µ–∫—Ü–∏—è –ø–æ—Ö–æ–¥–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—à–∏–±–æ–∫
    gait.adjustForBalance(rollError, pitchError);
}
```

## API Reference

### –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
```cpp
PID(float Kp, float Ki, float Kd);
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã

**–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–∞:**
```cpp
float compute(float setpoint, float measured, float dt = 0.0);
// setpoint - —Ü–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
// measured - —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
// dt - –≤—Ä–µ–º—è —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—ã–∑–æ–≤–∞ (–∞–≤—Ç–æ –µ—Å–ª–∏ 0)
```

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤:**
```cpp
void setGains(float Kp, float Ki, float Kd);
```

**–õ–∏–º–∏—Ç—ã –≤—ã—Ö–æ–¥–∞:**
```cpp
void setOutputLimits(float min, float max);
```

**Anti-windup (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞–ª–∞):**
```cpp
void setIntegralLimits(float min, float max);
```

**–°–±—Ä–æ—Å:**
```cpp
void reset();  // –û–±–Ω—É–ª—è–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞–ª –∏ –æ—à–∏–±–∫—É
```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

**–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∏—Ö:**
```cpp
float getP();        // –ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è
float getI();        // –ò–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω–∞—è
float getD(float dt);// –î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è
float getOutput();   // –û–±—â–∏–π –≤—ã—Ö–æ–¥
```

## Anti-Windup (–∑–∞—â–∏—Ç–∞ –æ—Ç –Ω–∞—Å—ã—â–µ–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞–ª–∞)

–ò–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω–∞—è —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∞—è –º–æ–∂–µ—Ç –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å—Å—è –¥–æ –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –ø—Ä–∏ –¥–æ–ª–≥–æ–π –æ—à–∏–±–∫–µ. –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è "integral windup".

**–ó–∞—â–∏—Ç–∞:**
```cpp
PID myPID(1.0, 0.5, 0.1);
myPID.setIntegralLimits(-50, 50);  // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞–ª–∞
```

–≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ –¥–ª—è:
- –ú–æ—Ç–æ—Ä–æ–≤ (—Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)
- –°–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥–æ–≤ (0-180¬∞)
- –ë–∞–ª–∞–Ω—Å–∞ (–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É–≥–æ–ª –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏)

## –û—Ç–ª–∞–¥–∫–∞ PID

### –í—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞:

```cpp
PID myPID(1.0, 0.1, 0.5);

void loop() {
    float output = myPID.compute(setpoint, measured);
    
    // CSV —Ñ–æ—Ä–º–∞—Ç –¥–ª—è Serial Plotter
    Serial.print(setpoint); Serial.print(",");
    Serial.print(measured); Serial.print(",");
    Serial.print(output); Serial.print(",");
    Serial.print(myPID.getP()); Serial.print(",");
    Serial.print(myPID.getI()); Serial.print(",");
    Serial.println(myPID.getD(0.01));
    
    delay(10);
}
```

–û—Ç–∫—Ä–æ–π—Ç–µ **Arduino Serial Plotter** –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏!

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ–µ–∫—Ç–æ–º

### –í main_controller:

```cpp
#include "pid.h"
#include "SF_IMU.h"

SF_IMU imu(Wire);
PID rollPID(2.0, 0.1, 0.5);
PID pitchPID(2.0, 0.1, 0.5);

void setup() {
    imu.begin();
    rollPID.setOutputLimits(-30, 30);
    pitchPID.setOutputLimits(-30, 30);
}

void loop() {
    imu.update();
    
    // –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è
    float rollCorr = rollPID.compute(0, imu.getRoll());
    float pitchCorr = pitchPID.compute(0, imu.getPitch());
    
    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ –∫–∏–Ω–µ–º–∞—Ç–∏–∫–µ
    applyBalanceCorrection(rollCorr, pitchCorr);
}
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–∞—á–∏–Ω–∞–π—Ç–µ —Å –º–∞–ª—ã—Ö –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤** –∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–π—Ç–µ
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ anti-windup** –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞–ª–∞
3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö** (–º–µ–¥–ª–µ–Ω–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å, –º–∞–ª–∞—è –∞–º–ø–ª–∏—Ç—É–¥–∞)
4. **–õ–æ–≥–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ** –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
5. **–°–±—Ä–∞—Å—ã–≤–∞–π—Ç–µ PID** –ø—Ä–∏ —Å–º–µ–Ω–µ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã

## –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞

- [PID Without a PhD - Tim Wescott](http://wescottdesign.com/articles/pid/pidWithoutAPhD.pdf)
- [Arduino PID Library](https://github.com/br3ttb/Arduino-PID-Library)
- StackForce Lesson 9: –ë–∏–æ–∏–º–∏—Ç–∞—Ü–∏—è –ø–æ—Ö–æ–¥–∫–∏

---

**PID –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä - —ç—Ç–æ –æ—Å–Ω–æ–≤–∞ —Ç–æ—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ–±–æ—Ç–æ–º! üéØ**
